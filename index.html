<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background-color: #70c5ce; /* sky blue */
    }
    canvas {
        display: block;
        margin: 0 auto;
        background-color: #f7ec4d; /* yellow */
        border: 5px solid #090909; /* black */
        border-radius: 10px;
    }
</style>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
<script>
let bird;
let pipes = [];
let score = 0;
let gamePaused = false;
let gameOver = false;

function setup() {
    createCanvas(windowWidth, windowHeight);
    bird = new Bird();
    pipes.push(new Pipe());
}

function draw() {
    background(112, 197, 206); // sky blue

    if (!gameOver) {
        for (let i = pipes.length - 1; i >= 0; i--) {
            pipes[i].update();
            pipes[i].show();

            if (pipes[i].hits(bird)) {
                gameOver = true;
            }

            if (pipes[i].offscreen()) {
                pipes.splice(i, 1);
                score++;
            }
        }

        bird.update();
        bird.show();

        if (frameCount % 120 === 0) { // Spawn new pipe every 120 frames
            pipes.push(new Pipe());
        }

        textSize(32);
        fill(255);
        text("Score: " + score, 20, 40);
    }

    if (gameOver) {
        textSize(64);
        fill(255, 0, 0);
        textAlign(CENTER);
        text("Game Over", width / 2, height / 2);
    }
}

function keyPressed() {
    if (key === ' ' && !gameOver && !gamePaused) {
        bird.up();
    } else if (key === ' ' && gameOver) {
        restartGame();
    }
}

function touchStarted() {
    if (!gameOver && !gamePaused) {
        bird.up();
    } else if (gameOver) {
        restartGame();
    }
}

function restartGame() {
    bird = new Bird();
    pipes = [];
    score = 0;
    gameOver = false;
}

class Bird {
    constructor() {
        this.y = height / 2;
        this.x = 64;
        this.gravity = 0.6;
        this.lift = -12;
        this.velocity = 0;
        this.icon = loadImage('bird.png');
    }

    show() {
        image(this.icon, this.x, this.y, 50, 50);
    }

    update() {
        this.velocity += this.gravity;
        this.velocity *= 0.9; // Air resistance
        this.y += this.velocity;

        if (this.y > height) {
            this.y = height;
            this.velocity = 0;
        }
        if (this.y < 0) {
            this.y = 0;
            this.velocity = 0;
        }
    }

    up() {
        this.velocity += this.lift;
    }
}

class Pipe {
    constructor() {
        this.top = random(height / 2);
        this.bottom = random(height / 2);
        this.x = width;
        this.w = 20;
        this.speed = 3;
        this.highlight = false;
    }

    show() {
        fill(0, 200, 0); // green
        if (this.highlight) {
            fill(255, 0, 0); // red if hits bird
        }
        rect(this.x, 0, this.w, this.top);
        rect(this.x, height - this.bottom, this.w, this.bottom);
    }

    update() {
        this.x -= this.speed;
    }

    offscreen() {
        return this.x < -this.w;
    }

    hits(bird) {
        if (bird.y < this.top || bird.y > height - this.bottom) {
            if (bird.x > this.x && bird.x < this.x + this.w) {
                this.highlight = true;
                return true;
            }
        }
        this.highlight = false;
        return false;
    }
}
</script>
</body>
</html>
